import{i as T,a as v,b as E,g as A,o as S}from"./index-9ccb475d.js";const x=function(){const e=typeof document<"u"&&document.createElement("link").relList;return e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}(),w=function(t){return"/"+t},g={},C=function(e,o,O){let p=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),r=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));p=Promise.allSettled(o.map(i=>{if(i=w(i),i in g)return;g[i]=!0;const c=i.endsWith(".css"),y=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${y}`))return;const s=document.createElement("link");if(s.rel=c?"stylesheet":x,c||(s.as="script"),s.crossOrigin="",s.href=i,r&&s.setAttribute("nonce",r),document.head.appendChild(s),c)return new Promise((b,I)=>{s.addEventListener("load",b),s.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${i}`)))})}))}function f(n){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=n,window.dispatchEvent(r),!r.defaultPrevented)throw n}return p.then(n=>{for(const r of n||[])r.status==="rejected"&&f(r.reason);return e().catch(f)})};console.log("NexusCore: Service Worker Iniciando...");const N={apiKey:"AIzaSyDznqrm2kJfKQXxWpgHWwk-msXH89OEgTo",authDomain:"banco-vc.firebaseapp.com",projectId:"banco-vc",storageBucket:"banco-vc.firebasestorage.app",messagingSenderId:"858410245985",appId:"1:858410245985:web:56fae7da4c145c30a32f20",measurementId:"G-4E7K9TY3B7"};let l,u,a=null,d=null;try{l=T(N),u=v(l,{persistence:E}),console.log("NexusCore: Auth inicializado com persistência IndexedDB.")}catch(t){t.code==="app/duplicate-app"?(console.log("NexusCore: App já inicializado, recuperando instância."),C(()=>import("./index-9ccb475d.js").then(e=>e.q),[]).then(e=>{l=e.getApp(),u=A(l)})):console.error("NexusCore: Erro fatal na inicialização:",t)}u&&S(u,async t=>{if(t){console.log(`NexusCore: Usuário conectado (${t.email})`);try{d=await t.getIdToken(),chrome.storage.sync.set({authMode:"login"})}catch(e){console.error("NexusCore: Erro ao obter token do usuário",e)}}else console.log("NexusCore: Usuário desconectado."),d=null});chrome.runtime.onMessage.addListener((t,e,o)=>(t.type==="CONFIG_UPDATED"&&(console.log("NexusCore: Configuração atualizada manualmente."),o({received:!0})),!0));const P="http://localhost:3000/api/ext/log",_="http://localhost:3000/api/ext/log_auth";async function L(t){try{const e=await chrome.storage.sync.get(["authMode","nexusTeamId","nexusMemberId"]);if(e.authMode==="login"&&d)await fetch(_,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(t)});else if(e.nexusTeamId&&e.nexusMemberId){const o={...t,teamId:e.nexusTeamId,memberId:e.nexusMemberId};await fetch(P,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}}catch{}}async function m(){if(!a)return;const t=Date.now(),e=Math.round((t-a.startTime)/1e3);e>2&&a.url&&!a.url.startsWith("chrome://")&&L({url:a.url,timestamp:new Date(a.startTime).toISOString(),duration:e}).catch(o=>console.debug("Erro background log:",o)),a=null}function h(t,e){a&&m(),e&&!e.startsWith("chrome://")&&!e.startsWith("about:")&&!e.startsWith("edge://")&&(a={id:t,url:e,startTime:Date.now()})}chrome.tabs.onActivated.addListener(async t=>{await m();try{const e=await chrome.tabs.get(t.tabId);e!=null&&e.url&&h(t.tabId,e.url)}catch{}});chrome.tabs.onUpdated.addListener((t,e,o)=>{e.status==="complete"&&o.active&&o.url&&h(t,o.url)});chrome.idle.onStateChanged.addListener(t=>{t==="active"?chrome.tabs.query({active:!0,currentWindow:!0},e=>{var o;(o=e[0])!=null&&o.url&&h(e[0].id,e[0].url)}):m()});
